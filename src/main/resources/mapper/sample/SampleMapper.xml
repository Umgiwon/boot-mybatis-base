<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bootmybatisbase.api.sample.mapper.SampleMapper">

    <!-- Sample 중복체크 (Inner Class 표기법 : OuterClass$InnerClass) -->
    <select id="existsSample"
            parameterType="com.bootmybatisbase.api.sample.dto.request.SampleSaveReqDto"
            resultType="com.bootmybatisbase.api.sample.dto.request.SampleSaveReqDto$DuplicateCheckResult">
        SELECT
            EXISTS (
                SELECT 1 FROM initial.TB_SAMPLE A WHERE A.TITLE = #{reqDto.title}
            ) AS TITLE_EXISTS
            , EXISTS (
                SELECT 1 FROM initial.TB_SAMPLE A WHERE A.CONTENT = #{reqDto.content}
            ) AS CONTENT_EXISTS
    </select>

    <!-- Sample 저장 후 저장 데이터 반환 -->
    <select id="insertSample"
            parameterType="com.bootmybatisbase.api.sample.dto.request.SampleSaveReqDto"
            resultType="com.bootmybatisbase.api.sample.dto.response.SampleResDto">
        INSERT INTO TB_SAMPLE (
            TITLE
            , CONTENT
            , CREATED_USER
            , CREATED_DATE
            , UPDATED_USER
            , UPDATED_DATE
        ) VALUES (
            #{reqDto.title}
            , #{reqDto.content}
            , #{reqDto.createdUser}
            , #{reqDto.createdDate}
            , #{reqDto.updatedUser}
            , #{reqDto.updatedDate}
        )
        RETURNING
            TITLE
            , CONTENT
            , CREATED_USER
            , CREATED_DATE
            , UPDATED_USER
            , UPDATED_DATE
    </select>

    <!-- Sample 목록 조회 -->
    <select id="getSampleList" resultType="com.bootmybatisbase.api.sample.dto.response.SampleResDto">
        SELECT A.SAMPLE_SN
             , A.TITLE
             , A.CONTENT
             , A.CREATED_USER
             , A.CREATED_DATE
             , A.UPDATED_USER
             , A.UPDATED_DATE
          FROM initial.TB_SAMPLE A
         ORDER BY A.CREATED_USER DESC
         LIMIT #{limit}
        OFFSET #{offset}
    </select>

    <!-- Sample 전체목록 카운트 조회 -->
    <select id="countSampleList" resultType="long">
        SELECT COUNT(*)
          FROM initial.TB_SAMPLE
    </select>

    <!-- Sample 단건 조회 -->
    <select id="getSample" resultType="com.bootmybatisbase.api.sample.dto.response.SampleResDto">
        SELECT A.SAMPLE_SN
             , A.TITLE
             , A.CONTENT
             , A.CREATED_USER
             , A.CREATED_DATE
             , A.UPDATED_USER
             , A.UPDATED_DATE
          FROM initial.TB_SAMPLE A
         WHERE A.SAMPLE_SN = #{sampleSm}
    </select>

</mapper>