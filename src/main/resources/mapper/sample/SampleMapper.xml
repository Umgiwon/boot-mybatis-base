<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bootmybatisbase.api.sample.mapper.SampleMapper">

    <!-- Sample 중복체크용 resultMap -->
    <resultMap id="duplicateCheckMap"
               type="com.bootmybatisbase.api.sample.dto.request.SampleInsertReqDto$DuplicateCheckResult">
        <result column="TITLE_EXISTS" property="titleExists"/>
        <result column="CONTENT_EXISTS" property="contentExists"/>
    </resultMap>

    <!-- Sample 조회용 resultMap -->
    <resultMap id="sampleVOMap"
               type="com.bootmybatisbase.api.sample.vo.SampleVO">
        <result column="SAMPLE_SN" property="sampleSn"/>
        <result column="TITLE" property="title"/>
        <result column="CONTENT" property="content"/>
        <result column="CREATED_USER" property="createdUser"/>
        <result column="CREATED_DATE" property="createdDate"/>
        <result column="UPDATED_USER" property="updatedUser"/>
        <result column="UPDATED_DATE" property="updatedDate"/>
    </resultMap>

    <!-- Sample 중복체크 (Inner Class 표기법 : OuterClass$InnerClass) -->
    <select id="existsSample"
            parameterType="com.bootmybatisbase.api.sample.dto.request.SampleInsertReqDto"
            resultMap="duplicateCheckMap">
        SELECT
            EXISTS (
                SELECT 1 FROM initial.TB_SAMPLE A WHERE A.TITLE = #{title}
            ) AS TITLE_EXISTS
            , EXISTS (
                SELECT 1 FROM initial.TB_SAMPLE A WHERE A.CONTENT = #{content}
            ) AS CONTENT_EXISTS
    </select>

    <!-- Sample 저장 후 저장 데이터 반환 -->
    <select id="insertSample"
            parameterType="com.bootmybatisbase.api.sample.vo.SampleVO"
            resultMap="sampleVOMap">
        INSERT INTO initial.TB_SAMPLE (
            TITLE
            , CONTENT
            , CREATED_USER
            , CREATED_DATE
            , UPDATED_USER
            , UPDATED_DATE
        ) VALUES (
            #{title}
            , #{content}
            , #{createdUser}
            , NOW()
            , #{updatedUser}
            , NOW()
        )
        RETURNING
            SAMPLE_SN
            , TITLE
            , CONTENT
            , CREATED_USER
            , CREATED_DATE
            , UPDATED_USER
            , UPDATED_DATE
    </select>

    <!-- Sample 목록 조회 -->
    <select id="getSampleList" resultMap="sampleVOMap">
        SELECT A.SAMPLE_SN
             , A.TITLE
             , A.CONTENT
             , A.CREATED_USER
             , A.CREATED_DATE
             , A.UPDATED_USER
             , A.UPDATED_DATE
          FROM initial.TB_SAMPLE A
         ORDER BY A.CREATED_DATE DESC
         LIMIT #{limit}
        OFFSET #{offset}
    </select>

    <!-- Sample 전체목록 카운트 조회 -->
    <select id="countSampleList" resultType="long">
        SELECT COUNT(*)
          FROM initial.TB_SAMPLE
    </select>

    <!-- Sample 단건 조회 -->
    <select id="getSample" resultMap="sampleVOMap">
        SELECT A.SAMPLE_SN
             , A.TITLE
             , A.CONTENT
             , A.CREATED_USER
             , A.CREATED_DATE
             , A.UPDATED_USER
             , A.UPDATED_DATE
          FROM initial.TB_SAMPLE A
         WHERE A.SAMPLE_SN = #{sampleSm}
    </select>

    <!-- Sample 수정 -->
    <update id="updateSample"
            parameterType="com.bootmybatisbase.api.sample.vo.SampleVO">
        UPDATE initial.TB_SAMPLE
        <set>
            <if test="title != null">
                TITLE = #{title},
            </if>
            <if test="content != null">
                CONTENT = #{content},
            </if>
            UPDATED_USER = #{updatedUser},
            UPDATED_DATE = NOW()
        </set>
         WHERE SAMPLE_SN = #{sampleSn}
    </update>

</mapper>